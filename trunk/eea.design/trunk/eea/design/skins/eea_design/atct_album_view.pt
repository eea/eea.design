<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
  lang="en-US"
  metal:use-macro="here/main_template/macros/master"
  i18n:domain="eea">

<body>

<metal:content-core fill-slot="content-core">
<metal:main_macro define-macro="content-core"
     tal:define="kssClassesView context/@@kss_field_decorator_view;
                 getKssClasses nocall:kssClassesView/getKssClassesInlineEditable;
                 templateId template/getId;
                 ">

    <div metal:define-macro="text-field-view"
             id="parent-fieldname-text" class="stx"
             tal:define="kss_class python:getKssClasses('text',
                         templateId=templateId, macro='text-field-view');
                         has_text exists:context/aq_explicit/getText;
                         text python:has_text and here.getText() or ''"
             tal:condition="text"
             tal:attributes="class python:test(here.Format() in ('text/structured',
                                                   'text/x-rst', ), 'stx' + kss_class, 'plain' + kss_class)">
            <div metal:define-slot="inside" tal:replace="structure text">The body</div>
    </div>

  <metal:listingmacro define-macro="listing" tal:define="
    entry_macro  entry_macro|context/atct_albumentry/macros/entry;
    folderContents folderContents|nothing;">
  

  <tal:folderContents condition="folderContents" tal:define="batch folderContents">
    <div metal:use-macro="here/batch_macros/macros/navigation" />
    <tal:images tal:repeat="brain folderContents">
      <tal:entry tal:define="
        obj brain/getObject;
        obj_title python:obj.pretty_title_or_id();
        desc_or_title python:brain.Description or obj_title;
        urlview obj/@@url;
        listing_url urlview/listing_url;
        is_video python:'p4a.video.interfaces.IVideoEnhanced' in brain.object_provides">
        <metal:entry use-macro="entry_macro" />
      </tal:entry>
    </tal:images>
    <div class="visualClear"></div>
    <div metal:use-macro="here/batch_macros/macros/navigation" />
  </tal:folderContents>

  <tal:comment replace="nothing">
      This macro lists the folder or topic contents which consists also of non image content just like images
      because we have fallback images from valentine image scales ichimdav #3488
  </tal:comment>
  <tal:noFolderContents tal:condition="not:folderContents" tal:define="
    contentFilter contentFilter|request/contentFilter|nothing;
    contentFilter python:contentFilter and dict(contentFilter) or {};
    limit_display limit_display|request/limit_display|nothing;
    limit_display python:limit_display and int(limit_display) or None;
    is_a_topic python:context.portal_type in ['Topic'];
    result python:is_a_topic and context.queryCatalog(batch=True, **contentFilter) or context.getFolderContents(contentFilter, batch=True, b_size=limit_display or 100);
    Batch python:modules['Products.CMFPlone'].Batch;
    b_start python:request.get('b_start', 0);
    batch python:isinstance(result, Batch) and result or Batch(result, limit_display or 100, int(b_start), orphan=1);">

  <div metal:use-macro="here/batch_macros/macros/navigation" />
    <tal:folderItems tal:condition="batch" tal:repeat="brain batch">
      <tal:entry tal:define="
        obj brain/getObject;
        desc_or_title python:brain.Description or obj.pretty_title_or_id;
        urlview obj/@@url;
        listing_url urlview/listing_url;
        is_video python:'p4a.video.interfaces.IVideoEnhanced' in brain.object_provides">

        <metal:entry use-macro="entry_macro" />
      </tal:entry>
    </tal:folderItems>
    <div class="visualClear"></div>
  <div metal:use-macro="here/batch_macros/macros/navigation" />

   <metal:empty metal:define-slot="no_items_in_listing">
        <p class="discreet"
           tal:condition="not:result"
           i18n:translate="description_no_items_in_folder">
            There are currently no items in this folder.
        </p>
    </metal:empty>
  </tal:noFolderContents>

  </metal:listingmacro>

  <!-- needed for frontpage gallery to have the listing without batch -->
  <metal:albummacro define-macro="listing-nobatch" tal:define="
    entry_macro  entry_macro|context/atct_albumentry/macros/entry;
    folderContents folderContents|nothing;
    enabled enabled|nothing">
  <tal:folderContents condition="python: folderContents and enabled" tal:define="batch folderContents">
    <tal:images tal:repeat="brain folderContents">
      <tal:entry tal:define="
        obj brain/getObject;
        obj_title python:obj.pretty_title_or_id();
        desc_or_title python:brain.Description or obj_title;
        urlview obj/@@url;
        listing_url urlview/listing_url;
        is_video python:'p4a.video.interfaces.IVideoEnhanced' in brain.object_provides;">
        <metal:entry use-macro="entry_macro" />
      </tal:entry>
    </tal:images>
    <div class="visualClear"></div>
    </tal:folderContents>
  </metal:albummacro>

  <metal:subtopics use-macro="here/atct_topic_view/macros/folderlisting_macro" />

</metal:main_macro>
</metal:content-core>

</body>

</html>
